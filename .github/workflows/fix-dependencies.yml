name: ðŸ”§ Fix Dependencies Lock File

on:
  workflow_dispatch:

jobs:
  fix-deps:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
    - name: ðŸ“¥ Checkout
      uses: actions/checkout@v4
    
    - name: ðŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: ðŸ“¦ Generate package-lock.json
      run: |
        echo "Generating package-lock.json..."
        npm install
        
        echo "âœ… Dependencies installed and lock file generated!"
        ls -la package*
    
    - name: ðŸ“¤ Commit lock file
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        git add package-lock.json
        
        if git diff --staged --quiet; then
          echo "No changes to commit"
        else
          git commit -m "ðŸ”§ Add package-lock.json for dependencies

          Generated by npm install to fix CI/CD workflows.
          This ensures consistent dependency versions across environments."
          
          git push
          echo "âœ… package-lock.json committed successfully!"
        fi
    
    - name: âœ… Success
      run: |
        echo "ðŸŽ‰ Dependencies fixed!"
        echo "Now you can run the update-news workflow successfully."
